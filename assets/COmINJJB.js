import{d as ie,cs as _e,c as Ae,A as Se,D as Le,bg as Ee,e as x,o as N,g as we,H as Ie,I as Ce,m as Q,h as le,p as Be}from"./vIUoIwJY.js";/**
 * Encodes an RGBA image to a PNG data URI. RGB should not be premultiplied by A.
 *
 * @remarks
 * This is optimized for speed and simplicity and does not optimize for size
 * at all. This does not do any compression (all values are stored uncompressed).
 *
 * @see https://github.com/evanw/thumbhash
 * @author Evan Wallace
 * @license MIT
 */function ue(e,t,r){const a=e*4+1,c=6+t*(5+a),n=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,e>>8,e&255,0,0,t>>8,t&255,8,6,0,0,0,0,0,0,0,c>>>24,c>>16&255,c>>8&255,c&255,73,68,65,84,120,1],u=[0,498536548,997073096,651767980,1994146192,1802195444,1303535960,1342533948,-306674912,-267414716,-690576408,-882789492,-1687895376,-2032938284,-1609899400,-1111625188];let d=1,s=0;for(let o=0,i=0,l=a-1;o<t;o++,l+=a-1)for(n.push(o+1<t?0:1,a&255,a>>8,~a&255,a>>8^255,0),s=(s+d)%65521;i<l;i++){const h=r[i]&255;n.push(h),d=(d+h)%65521,s=(s+d)%65521}n.push(s>>8,s&255,d>>8,d&255,0,0,0,0,0,0,0,0,73,69,78,68,174,66,96,130);for(let[o,i]of[[12,29],[37,41+c]]){let l=-1;for(let h=o;h<i;h++)l^=n[h],l=l>>>4^u[l&15],l=l>>>4^u[l&15];l=~l,n[i++]=l>>>24,n[i++]=l>>16&255,n[i++]=l>>8&255,n[i++]=l&255}return`data:image/png;base64,${globalThis.btoa(String.fromCharCode(...n))}`}const de=new Uint8Array(128);for(let e=0;e<83;e++)de["0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz#$%*+,-.:;=?@[]^_{|}~".charCodeAt(e)]=e;const j=(e,t,r)=>{let a=0;for(;t<r;)a*=83,a+=de[e.charCodeAt(t++)];return a},fe=Math.pow,H=Math.PI,Te=H*2,pe=3294.6,he=269.025,Ue=e=>e>10.31475?fe(e/he+.052132,2.4):e/pe,K=e=>~~(e>1227e-8?he*fe(e,.416666)-13.025:e*pe+1),O=e=>(e<0?-1:1)*e*e,ce=e=>{for(e+=H/2;e>H;)e-=Te;const t=1.27323954*e-.405284735*O(e);return .225*(O(t)-t)+t};function Ge(e){const t=j(e,2,6);return[t>>16,t>>8&255,t&255]}function Pe(e,t,r,a){const c=j(e,0,1),n=c%9+1,u=~~(c/9)+1,d=n*u;let s=0,p=0,o=0,i=0,l=0,h=0,B=0,v=0,L=0,b=0,_=0,E=0;const T=(j(e,1,2)+1)/13446*(a|1),g=new Float64Array(d*3),w=Ge(e);for(s=0;s<3;s++)g[s]=Ue(w[s]);for(s=1;s<d;s++)E=j(e,4+s*2,6+s*2),g[s*3]=O(~~(E/361)-9)*T,g[s*3+1]=O(~~(E/19)%19-9)*T,g[s*3+2]=O(E%19-9)*T;const D=new Float64Array(u*r),$=new Float64Array(n*t);for(p=0;p<u;p++)for(i=0;i<r;i++)D[p*r+i]=ce(H*i*p/r);for(s=0;s<n;s++)for(o=0;o<t;o++)$[s*t+o]=ce(H*o*s/t);const k=t*4,A=new Uint8ClampedArray(k*r);for(i=0;i<r;i++)for(o=0;o<t;o++){for(l=h=B=0,p=0;p<u;p++)for(L=D[p*r+i],s=0;s<n;s++)v=$[s*t+o]*L,b=(s+p*n)*3,l+=g[b]*v,h+=g[b+1]*v,B+=g[b+2]*v;_=4*o+i*k,A[_]=K(l),A[_+1]=K(h),A[_+2]=K(B),A[_+3]=255}return A}const re=32,Re="data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1 1'%3E%3C/svg%3E";function Ne(e,{ratio:t=1,size:r=re}={}){const{width:a,height:c}=Oe(t,r),n=Pe(e,a,c);return ue(a,c,n)}function Oe(e,t){const r=e>=1;return{width:r?t:Math.round(t*e),height:r?Math.round(t/e):t}}function He(e){let{PI:t,min:r,max:a,cos:c,round:n}=Math,u=e[0]|e[1]<<8|e[2]<<16,d=e[3]|e[4]<<8,s=(u&63)/63,p=(u>>6&63)/31.5-1,o=(u>>12&63)/31.5-1,i=(u>>18&31)/31,l=u>>23,h=(d>>3&63)/63,B=(d>>9&63)/63,v=d>>15,L=a(3,v?l?5:7:d&7),b=a(3,v?d&7:l?5:7),_=l?(e[5]&15)/15:1,E=(e[5]>>4)/15,T=l?6:5,g=0,w=(G,z,P)=>{let I=[];for(let S=0;S<z;S++)for(let C=S?0:1;C*z<G*(z-S);C++)I.push(((e[T+(g>>1)]>>((g++&1)<<2)&15)/7.5-1)*P);return I},D=w(L,b,i),$=w(3,3,h*1.25),k=w(3,3,B*1.25),A=l&&w(5,5,E),M=De(e),q=n(M>1?32:32*M),F=n(M>1?32/M:32),U=new Uint8Array(q*F*4),W=[],Y=[];for(let G=0,z=0;G<F;G++)for(let P=0;P<q;P++,z+=4){let I=s,S=p,C=o,ae=_;for(let f=0,y=a(L,l?5:3);f<y;f++)W[f]=c(t/q*(P+.5)*f);for(let f=0,y=a(b,l?5:3);f<y;f++)Y[f]=c(t/F*(G+.5)*f);for(let f=0,y=0;f<b;f++)for(let m=f?0:1,R=Y[f]*2;m*b<L*(b-f);m++,y++)I+=D[y]*W[m]*R;for(let f=0,y=0;f<3;f++)for(let m=f?0:1,R=Y[f]*2;m<3-f;m++,y++){let ne=W[m]*R;S+=$[y]*ne,C+=k[y]*ne}if(l)for(let f=0,y=0;f<5;f++)for(let m=f?0:1,R=Y[f]*2;m<5-f;m++,y++)ae+=A[y]*W[m]*R;let se=I-2/3*S,oe=(3*I-se+C)/2,ve=oe-C;U[z]=a(0,255*r(1,oe)),U[z+1]=a(0,255*r(1,ve)),U[z+2]=a(0,255*r(1,se)),U[z+3]=a(0,255*r(1,ae))}return{w:q,h:F,rgba:U}}function De(e){let t=e[3],r=e[2]&128,a=e[4]&128,c=a?r?5:7:t&7,n=a?t&7:r?5:7;return c/n}function $e(e){const t=ke(e),{w:r,h:a,rgba:c}=He(t);return ue(r,a,c)}function ke(e){return Uint8Array.from(globalThis.atob(Me(e)),t=>t.charCodeAt(0))}function Me(e){return e.replaceAll("-","+").replaceAll("_","/")}const ye=typeof window>"u",qe=!ye&&"loading"in HTMLImageElement.prototype,Fe=!ye&&(!("onscroll"in window)||/(?:gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent));function me(e,t=document){return typeof e=="string"?[...t.querySelectorAll(e)]:e instanceof Element?[e]:[...e]}function We(e){const t=Date.now();return Re.replace(/\s/,` data-id='${t}-${e}' `)}function Ye(e,t){let r;return function(...a){r!=null&&clearTimeout(r),r=setTimeout(()=>{e(...a),r=void 0},t)}}function xe(e='img[loading="lazy"]',{hash:t=!0,hashType:r="blurhash",placeholderSize:a=re,updateSizesOnResize:c=!1,onImageLoad:n}={}){const u=new Set;for(const[d,s]of me(e).entries()){const p=V(s,{updateOnResize:c});if(c&&p&&u.add(p),t){const i=te({image:s,hash:typeof t=="string"?t:void 0,hashType:r,size:a});i&&(s.src=i)}if(!s.dataset.src&&!s.dataset.srcset)continue;if(Fe||!qe){be(s),J(s),X(s);continue}if(s.src||(s.src=We(d)),s.complete&&s.naturalWidth>0){ee(s,n);continue}const o=()=>ee(s,n);s.addEventListener("load",o,{once:!0}),u.add(()=>s.removeEventListener("load",o))}return()=>{for(const d of u)d();u.clear()}}function Ze(e='img[data-sizes="auto"], source[data-sizes="auto"]'){for(const t of me(e))V(t)}function ee(e,t){if(ze(e)){be(e),J(e),X(e),t?.(e);return}const r=new Image,{srcset:a,src:c,sizes:n}=e.dataset;if(n==="auto"){const u=ge(e);u&&(r.sizes=`${u}px`)}else e.sizes&&(r.sizes=e.sizes);a&&(r.srcset=a),c&&(r.src=c),r.addEventListener("load",()=>{J(e),X(e),t?.(e)},{once:!0})}function te({image:e,hash:t,hashType:r="blurhash",size:a=re,ratio:c}={}){if(e&&!t){const{blurhash:n,thumbhash:u}=e.dataset;t=u||n,r=u?"thumbhash":"blurhash"}if(t)try{if(r==="blurhash"){if(e&&!c){const n=e.width||e.offsetWidth||a,u=e.height||e.offsetHeight||a;c=n/u}return Ne(t,{ratio:c,size:a})}return $e(t)}catch{}}const Z=new WeakMap;function V(e,t){if(e.dataset.sizes!=="auto")return;const r=ge(e);if(r&&(e.sizes=`${r}px`),ze(e)&&t?.processSourceElements)for(const a of[...e.parentElement.getElementsByTagName("source")])V(a,{processSourceElements:!0});if(t?.updateOnResize){if(!Z.has(e)){const a=Ye(()=>V(e),500),c=new ResizeObserver(a);Z.set(e,c),c.observe(e)}return()=>{const a=Z.get(e);a&&(a.disconnect(),Z.delete(e))}}}function X(e){e.dataset.src&&(e.src=e.dataset.src,e.removeAttribute("data-src"))}function J(e){e.dataset.srcset&&(e.srcset=e.dataset.srcset,e.removeAttribute("data-srcset"))}function be(e){const t=e.parentElement;t?.tagName.toLowerCase()==="picture"&&([...t.querySelectorAll("source[data-srcset]")].forEach(J),[...t.querySelectorAll("source[data-src]")].forEach(X))}function ge(e){return e instanceof HTMLSourceElement?e.parentElement?.getElementsByTagName("img")[0]?.offsetWidth:e.offsetWidth}function ze(e){return e.parentElement?.tagName.toLowerCase()==="picture"}const je={key:0},Ve=["type","data-srcset","data-sizes"],Xe=["src","data-src","data-srcset","data-sizes","loading"],Je=["src","data-src","data-srcset","data-sizes","loading"],Ke=ie({inheritAttrs:!1,__name:"UnLazyImage",props:{src:{default:void 0},srcSet:{default:void 0},sources:{default:void 0},autoSizes:{type:Boolean,default:!1},blurhash:{default:void 0},thumbhash:{default:void 0},placeholderSrc:{default:void 0},placeholderSize:{default:void 0},placeholderRatio:{default:void 0},lazyLoad:{type:Boolean,default:!0},preload:{type:Boolean,default:!1},ssr:{type:Boolean,default:void 0},loading:{default:void 0}},emits:["loaded","error"],setup(e,{emit:t}){const r=e,a=t,c=_e().public.unlazy,n=Ae(()=>r.thumbhash||r.blurhash),u=(r.ssr??c.ssr)&&n.value?te({hash:n.value,hashType:r.thumbhash?"thumbhash":"blurhash",size:r.placeholderSize||c.placeholderSize,ratio:r.placeholderRatio}):void 0,d=Se();let s,p;return Le(()=>{if(s?.(),!!d.value){if(n.value&&n.value!==p){const o=te({image:d.value,hash:n.value,hashType:r.thumbhash?"thumbhash":"blurhash",size:r.placeholderSize||c.placeholderSize,ratio:r.placeholderRatio});o&&(d.value.src=o),p=n.value}if(r.preload){r.autoSizes&&Ze(d.value),ee(d.value,o=>a("loaded",o));return}r.lazyLoad&&(s=xe(d.value,{hash:!1,onImageLoad(o){a("loaded",o)}}))}}),Ee(()=>{s?.()}),(o,i)=>o.sources?.length?(N(),x("picture",je,[(N(!0),x(Ie,null,Ce(o.sources,(l,h)=>(N(),x("source",{key:h,type:l.type,"data-srcset":l.srcSet,"data-sizes":l.sizes},null,8,Ve))),128)),we("img",Q({ref_key:"target",ref:d},o.$attrs,{src:le(u)||o.placeholderSrc,"data-src":o.src,"data-srcset":o.srcSet,"data-sizes":o.autoSizes?"auto":void 0,loading:o.loading||(r.lazyLoad?"lazy":"eager"),onError:i[0]||(i[0]=l=>a("error",l))}),null,16,Xe)])):(N(),x("img",Q({key:1,ref_key:"target",ref:d},o.$attrs,{src:le(u)||o.placeholderSrc,"data-src":o.src,"data-srcset":o.srcSet,"data-sizes":o.autoSizes?"auto":void 0,loading:o.loading||(r.lazyLoad?"lazy":"eager"),onError:i[1]||(i[1]=l=>a("error",l))}),null,16,Je))}}),et=ie({inheritAttrs:!1,__name:"CommonBlurhash",props:{blurhash:{default:""},src:{},srcset:{},shouldLoadImage:{type:Boolean,default:!0}},setup(e){return(t,r)=>{const a=Ke;return N(),Be(a,Q(t.$attrs,{blurhash:t.blurhash,src:t.src,"src-set":t.srcset,"lazy-load":t.shouldLoadImage,"auto-sizes":""}),null,16,["blurhash","src","src-set","lazy-load"])}}});export{et as _};
