import{d as G,c as T,A as Y,z as P,aW as H,e as m,o as i,g as n,r as F,Q as M,h as e,H as I,f as c,G as R,q as p,_ as B,aX as L,ay as j,aY as q,t as g,aZ as X,I as O,p as f,aL as D,aG as J,l as K,F as Q,a_ as Z,a$ as tt,y as ot,j as et,ad as nt,b0 as it,a as at,b as st,aU as rt,O as ct,P as ut}from"./vIUoIwJY.js";import{a as lt,b as pt,c as dt,d as ft,e as mt,_ as gt}from"./v1qJ5AFC.js";import{_ as _t}from"./LllTNCQO.js";import{_ as yt}from"./CXZMboa-.js";import{_ as vt}from"./BoAoxP_Z.js";import{_ as bt}from"./Dxdd2Bvb.js";import{s as ht,_ as kt}from"./CrVpdqfN.js";import{u as U}from"./CqJbzpr4.js";const At=["lang"],wt={flex:"","items-center":"","top-0":"","left-2":"","pt-2":"","px-3":""},$t=["datetime"],Nt={"me-1":"","ws-nowrap":""},Rt=["datetime"],Ct={"pb-2":"",ps8:""},xt={flex:"~ 1","items-center":""},St={key:0,"ps-2":"",text:"base lg"},Tt={key:1},W=5,It=G({__name:"NotificationGroupedFollow",props:{items:{}},setup(N){const _=T(()=>N.items.items),C=T(()=>_.value.slice(0,W)),d=T(()=>_.value.length),w=T(()=>Math.max(d.value-W,0)),o=Y(!1),a=T(()=>d.value>1||d.value===0?void 0:N.items.items[0].status?.language),h=P(!0),x=T(()=>_.value[0].createdAt),s=H(()=>x.value,h);return(y,k)=>{const u=j,r=B,l=q,$=X,A=D,v=lt;return i(),m("article",{flex:"","flex-col":"",relative:"",lang:e(a)??void 0},[n("div",wt,[n("div",{class:M(e(d)>1?"i-ri-group-line":"i-ri-user-3-line"),"me-3":"","color-blue":"","text-xl":"","aria-hidden":"true"},null,2),e(d)>1?(i(),m(I,{key:0},[c(l,{account:e(_)[0].account},{default:p(()=>[c(r,{to:("getAccountRoute"in y?y.getAccountRoute:e(L))(e(_)[0].account)},{default:p(()=>[c(u,{account:e(_)[0].account,"text-primary":"","font-bold":"","line-clamp-1":"","ws-pre-wrap":"","break-all":"","hover:underline":""},null,8,["account"])]),_:1},8,["to"])]),_:1},8,["account"]),R("  "+g(y.$t("notification.and"))+"  ",1),c($,{keypath:"notification.others",count:e(d)-1,"text-primary":"","font-bold":"","line-clamp-1":"","ws-pre-wrap":"","break-all":""},null,8,["count"]),R("  "+g(y.$t("notification.followed_you"))+" ",1),n("time",{"text-secondary":"",datetime:e(x)}," ・"+g(e(s)),9,$t)],64)):e(d)===1?(i(),m(I,{key:1},[c(r,{to:("getAccountRoute"in y?y.getAccountRoute:e(L))(e(_)[0].account)},{default:p(()=>[c(u,{account:e(_)[0].account,"text-primary":"","me-1":"","font-bold":"","line-clamp-1":"","ws-pre-wrap":"","break-all":"","hover:underline":""},null,8,["account"])]),_:1},8,["to"]),n("span",Nt,[R(g(y.$t("notification.followed_you"))+" ",1),n("time",{"text-secondary":"",datetime:e(x)}," ・"+g(e(s)),9,Rt)])],64)):F("",!0)]),n("div",Ct,[!e(o)&&e(d)>1?(i(),m("div",{key:0,flex:"~ wrap gap-1.75",p4:"","items-center":"","cursor-pointer":"",onClick:k[0]||(k[0]=t=>o.value=!e(o))},[(i(!0),m(I,null,O(e(C),t=>(i(),f(l,{key:t.id,account:t.account},{default:p(()=>[c(r,{to:("getAccountRoute"in y?y.getAccountRoute:e(L))(t.account)},{default:p(()=>[c(A,{account:t.account,"w-12":"","h-12":""},null,8,["account"])]),_:2},1032,["to"])]),_:2},1032,["account"]))),128)),n("div",xt,[e(w)>0?(i(),m("span",St,"+"+g(e(w)),1)):F("",!0),k[2]||(k[2]=n("div",{"i-ri:arrow-down-s-line":"","mx-1":"","text-secondary":"","text-xl":"","aria-hidden":"true"},null,-1))])])):(i(),m("div",Tt,[e(d)>1?(i(),m("div",{key:0,flex:"","p-4":"","pb-2":"","cursor-pointer":"",onClick:k[1]||(k[1]=t=>o.value=!e(o))},k[3]||(k[3]=[n("div",{"i-ri:arrow-up-s-line":"","ms-2":"","text-secondary":"","text-xl":"","aria-hidden":"true"},null,-1),n("span",{"ps-2":"","text-base":""},"Hide",-1)]))):F("",!0),(i(!0),m(I,null,O(e(_),t=>(i(),f(l,{key:t.id,account:t.account},{default:p(()=>[c(r,{to:("getAccountRoute"in y?y.getAccountRoute:e(L))(t.account),flex:"","gap-4":"","px-4":"","py-2":""},{default:p(()=>[c(A,{account:t.account,"w-12":"","h-12":""},null,8,["account"]),c(v,{account:t.account},null,8,["account"])]),_:2},1032,["to"])]),_:2},1032,["account"]))),128))]))])],8,At)}}}),Ft={flex:"","flex-col":"",relative:""},Lt={flex:"","flex-col":"","gap-3":""},Gt={key:0,flex:"~ gap-1"},Et={ml1:""},Ht=["datetime"],Ot={key:1,flex:"~ gap-1 wrap"},Pt={"ms-4":""},Bt=["datetime"],Vt={ps9:"","mt-1":""},Wt=G({__name:"NotificationGroupedLikes",props:{group:{}},setup(N){const _=J("useStarFavoriteIcon"),C=T(()=>N.group.likes.filter(s=>s.reblog)),d=T(()=>N.group.likes.filter(s=>s.favourite&&!s.reblog)),w=P(!0),o=T(()=>C.value[0].reblog?.createdAt),a=H(()=>o.value??"",w),h=T(()=>d.value[0].favourite?.createdAt),x=H(()=>h.value??"",w);return(s,y)=>{const k=D,u=B,r=q,l=pt,$=dt,A=ft,v=mt;return i(),m("article",Ft,[c(v,{status:s.group.status,pb4:"",pt5:""},{default:p(()=>[n("div",Lt,[e(C).length?(i(),m("div",Gt,[y[0]||(y[0]=n("div",{"i-ri:repeat-fill":"","text-xl":"","me-2":"","color-green":""},null,-1)),(i(!0),m(I,null,O(e(C),(t,b)=>(i(),f(r,{key:b,account:t.account},{default:p(()=>[c(u,{to:("getAccountRoute"in s?s.getAccountRoute:e(L))(t.account)},{default:p(()=>[c(k,{"text-primary":"","font-bold":"",account:t.account,class:"h-1.5em w-1.5em"},null,8,["account"])]),_:2},1032,["to"])]),_:2},1032,["account"]))),128)),n("div",Et,[R(g(s.$t("notification.reblogged_post"))+" ",1),n("time",{"text-secondary":"",datetime:e(o)}," ・"+g(e(a)),9,Ht)])])):F("",!0),e(d).length?(i(),m("div",Ot,[n("div",{class:M(e(_)?"i-ri:star-line color-yellow":"i-ri:heart-line color-red"),"text-xl":"","me-2":""},null,2),(i(!0),m(I,null,O(e(d),(t,b)=>(i(),f(r,{key:b,account:t.account,relative:"","me--4":"",border:"2 bg-base","rounded-full":"","hover:z-1":"","focus-within:z-1":""},{default:p(()=>[c(u,{to:("getAccountRoute"in s?s.getAccountRoute:e(L))(t.account)},{default:p(()=>[c(k,{"text-primary":"","font-bold":"",account:t.account,class:"h-1.5em w-1.5em"},null,8,["account"])]),_:2},1032,["to"])]),_:2},1032,["account"]))),128)),n("div",Pt,[R(g(s.$t("notification.favourited_post"))+" ",1),n("time",{"text-secondary":"",datetime:e(h)}," ・"+g(e(x)),9,Bt)])])):F("",!0)]),n("div",Vt,[c(l,{status:s.group.status,"text-secondary":""},null,8,["status"]),s.group.status.content?F("",!0):(i(),m(I,{key:0},[s.group.status.mediaAttachments?.length?(i(),f($,{key:0,status:s.group.status,"is-preview":!1,"pointer-events-none":""},null,8,["status"])):s.group.status.poll?(i(),f(A,{key:1,status:s.group.status},null,8,["status"])):F("",!0)],64))])]),_:1},8,["status"])])}}}),zt={flex:"","flex-col":"",relative:""},Mt={flex:"","items-center":"",absolute:"","ps-3":"","pe-4":"","inset-is-0":"","rounded-ie-be-3":"","py-3":"","bg-base":"","top-0":""},jt={"ws-nowrap":""},qt=["datetime"],Dt={flex:"",p4:"","items-center":"","bg-shaded":""},Ut=["datetime"],Yt={flex:"",p4:"","items-center":"","bg-shaded":""},Xt={flex:"","px-3":"","py-2":""},Jt={"me-1":"","ws-nowrap":""},Kt=["datetime"],Qt={flex:"~","gap-1":"","items-center":"",mt1:""},Zt={"ws-nowrap":""},to=["datetime"],oo={key:6,flex:"",p4:"","items-center":"","bg-shaded":""},eo={class:"content-rich"},no=G({__name:"NotificationCard",props:{notification:{}},setup(N){K();const _=["follow","admin.sign_up","admin.report","follow_request","update","mention","poll","update","status","annual_report"];["pleroma:emoji_reaction","reaction"].includes(N.notification.type)||_.includes(N.notification.type);const d=P(!0),w=H(()=>N.notification.createdAt,d);return(o,a)=>{const h=j,x=_t,s=B,y=Q("i18n-t"),k=yt,u=vt,r=bt,l=gt;return i(),m("article",zt,[o.notification.type==="follow"?(i(),f(s,{key:0,to:("getAccountRoute"in o?o.getAccountRoute:e(L))(o.notification.account)},{default:p(()=>[n("div",Mt,[a[0]||(a[0]=n("div",{"i-ri-user-3-line":"","text-xl":"","me-3":"","color-blue":""},null,-1)),c(h,{account:o.notification.account,"text-primary":"","me-1":"","font-bold":"","line-clamp-1":"","ws-pre-wrap":"","break-all":""},null,8,["account"]),n("span",jt,[R(g(o.$t("notification.followed_you"))+" ",1),n("time",{"text-secondary":"",datetime:o.notification.createdAt}," ・"+g(e(w)),9,qt)])]),c(x,{ms10:"",account:o.notification.account},null,8,["account"])]),_:1},8,["to"])):o.notification.type==="admin.sign_up"?(i(),f(s,{key:1,to:("getAccountRoute"in o?o.getAccountRoute:e(L))(o.notification.account)},{default:p(()=>[n("div",Dt,[a[1]||(a[1]=n("div",{"i-ri:user-add-line":"","text-xl":"","me-2":"","color-purple":""},null,-1)),c(h,{account:o.notification.account,"text-purple":"","me-1":"","font-bold":"","line-clamp-1":"","ws-pre-wrap":"","break-all":""},null,8,["account"]),n("span",null,[R(g(o.$t("notification.signed_up"))+" ",1),n("time",{"text-secondary":"",datetime:o.notification.createdAt}," ・"+g(e(w)),9,Ut)])])]),_:1},8,["to"])):o.notification.type==="admin.report"?(i(),f(s,{key:2,to:("getReportRoute"in o?o.getReportRoute:e(Z))(o.notification.report?.id)},{default:p(()=>[n("div",Yt,[a[2]||(a[2]=n("div",{"i-ri:flag-line":"","text-xl":"","me-2":"","color-purple":""},null,-1)),c(y,{keypath:"notification.reported"},{default:p(()=>[c(h,{account:o.notification.account,"text-purple":"","me-1":"","font-bold":"","line-clamp-1":"","ws-pre-wrap":"","break-all":""},null,8,["account"]),c(h,{account:o.notification.report?.targetAccount,"text-purple":"","ms-1":"","font-bold":"","line-clamp-1":"","ws-pre-wrap":"","break-all":""},null,8,["account"])]),_:1})])]),_:1},8,["to"])):o.notification.type==="follow_request"?(i(),m(I,{key:3},[n("div",Xt,[a[3]||(a[3]=n("div",{"i-ri-user-shared-line":"","text-xl":"","me-3":"","color-blue":""},null,-1)),c(h,{account:o.notification.account,"text-primary":"","me-1":"","font-bold":"","line-clamp-1":"","ws-pre-wrap":"","break-all":""},null,8,["account"]),n("span",Jt,[R(g(o.$t("notification.request_to_follow"))+" ",1),n("time",{"text-secondary":"",datetime:o.notification.createdAt}," ・"+g(e(w)),9,Kt)])]),c(u,{p:"s-2 e-4 b-2","hover-card":"",account:o.notification.account},{default:p(()=>[c(k,{account:o.notification.account},null,8,["account"])]),_:1},8,["account"])],64)):o.notification.type==="update"?(i(),f(l,{key:4,status:o.notification.status,"in-notification":!0,actions:!1},{meta:p(()=>[n("div",Qt,[a[4]||(a[4]=n("div",{"i-ri:edit-2-fill":"","text-xl":"","me-1":"","text-secondary":""},null,-1)),c(r,{account:o.notification.account,me1:""},null,8,["account"]),n("span",Zt,[R(g(o.$t("notification.update_status"))+" ",1),n("time",{"text-secondary":"",datetime:o.notification.createdAt}," ・"+g(e(w)),9,to)])])]),_:1},8,["status"])):o.notification.type==="mention"||o.notification.type==="poll"||o.notification.type==="status"?(i(),f(l,{key:5,status:o.notification.status},null,8,["status"])):o.notification.type==="annual_report"?(i(),m("div",oo,[a[9]||(a[9]=n("div",{"i-mdi:party-popper":"","text-xl":"","me-4":"","color-purple":""},null,-1)),n("div",eo,[n("p",null,[a[6]||(a[6]=R(" Your 2024 ")),c(s,{to:"/tags/Wrapstodon"},{default:p(()=>a[5]||(a[5]=[R(" #Wrapstodon ")])),_:1}),a[7]||(a[7]=R(" awaits! Unveil your year's highlights and memorable moments on Mastodon! "))]),n("p",null,[c(s,{to:`https://${"currentServer"in o?o.currentServer:e(tt)}/notifications`,target:"_blank"},{default:p(()=>a[8]||(a[8]=[R(" View #Wrapstodon on Mastodon ")])),_:1},8,["to"])])])])):F("",!0)])}}}),io=["onClick"],z=!1,ao=G({__name:"NotificationPaginator",props:{paginator:{},stream:{}},setup(N){const _=Number.MAX_VALUE,C=["update","mention","poll","status"];let d=0;function w({type:u,status:r}){return r||!C.includes(u)}function o(u){const r=u.status?{status:u.status?.id,type:u.type==="reblog"||u.type==="favourite"?"like":u.type}:{type:u.type};return JSON.stringify(r)}function a(u){return!u.header.endsWith("/original/missing.png")}function h(u){const r=[];let l="",$=[];const A=()=>{if($.length===0)return;const v=$;if($=[],v[0].type==="follow"){const t=[...v];t.sort((b,S)=>{const E=a(b.account),V=a(S.account);return V&&!E?1:E&&!V?-1:S.account.followersCount-b.account.followersCount}),t.length>0&&a(t[0].account)&&r.push(t.shift()),t.length===1&&a(t[0].account)&&r.push(t.shift()),t.length>0&&r.push({id:`grouped-${d++}`,type:"grouped-follow",items:t});return}else if(v.length&&(v[0].type==="reblog"||v[0].type==="favourite")){if(!v[0].status)return;const t=[];for(const b of v){let S=t.find(E=>E.account.id===b.account.id);S||(S={account:b.account},t.push(S)),S[b.type==="reblog"?"reblog":"favourite"]=b}t.sort((b,S)=>b.reblog&&(!S.reblog||b.favourite&&!S.favourite)?-1:0),r.push({id:`grouped-${d++}`,type:"grouped-reblogs-and-favourites",status:v[0].status,likes:t});return}r.push(...v)};for(const v of u.filter(w)){const t=o(v);(l!==t||$.length>=_)&&A(),$.push(v),l=t}return A(),r}function x(u){return u.filter(r=>!r.status?.filtered?.find(l=>l.filter.filterAction==="hide"&&l.filter.context.includes("notifications")))}function s(u){const r=[];for(const l of u)if(l.type==="grouped-reblogs-and-favourites"){const $=l;for(const A of $.likes)A.reblog&&r.push(A.reblog),A.favourite&&r.push(A.favourite)}else l.type==="grouped-follow"?r.push(...l.items):r.push(l);return h(x(r))}const{clearNotifications:y}=U(),{formatNumber:k}=ot();return(u,r)=>{const l=It,$=Wt,A=no,v=kt;return i(),f(v,{paginator:u.paginator,preprocess:s,stream:u.stream,eventType:"notification",virtualScroller:z},{updater:p(({number:t,update:b})=>[n("button",{id:"elk_show_new_items","py-4":"",border:"b base",flex:"~ col","p-3":"","w-full":"","text-primary":"","font-bold":"",onClick:()=>{b(),e(y)()}},g(u.$t("timeline.show_new_items",t,{named:{v:e(k)(t)}})),9,io)]),default:p(({item:t,active:b})=>[z?(i(),f(e(ht),{key:0,item:t,active:b,tag:"div"},{default:p(()=>[t.type==="grouped-follow"?(i(),f(l,{key:0,items:t,border:"b base"},null,8,["items"])):t.type==="grouped-reblogs-and-favourites"?(i(),f($,{key:1,group:t,border:"b base"},null,8,["group"])):(i(),f(A,{key:2,notification:t,"hover:bg-active":"",border:"b base"},null,8,["notification"]))]),_:2},1032,["item","active"])):(i(),m(I,{key:1},[t.type==="grouped-follow"?(i(),f(l,{key:0,items:t,border:"b base"},null,8,["items"])):t.type==="grouped-reblogs-and-favourites"?(i(),f($,{key:1,group:t,border:"b base"},null,8,["group"])):(i(),f(A,{key:2,notification:t,"hover:bg-active":"",border:"b base"},null,8,["notification"]))],64))]),_:1},8,["paginator","stream"])}}}),go=G({__name:"TimelineNotifications",props:{filter:{}},setup(N){const _=et(),C=nt(it,""),d={limit:30,types:N.filter?[N.filter]:[]},w=at().v1.notifications.list(d),o=st(h=>h.user.notification.subscribe());C.value=_.path.replace(/\/notifications\/?/,"");const{clearNotifications:a}=U();return rt(()=>{a(),C.value=_.path.replace(/\/notifications\/?/,"")}),(h,x)=>{const s=ao;return i(),f(s,ct(ut({paginator:e(w),stream:e(o)})),null,16)}}});export{go as _};
