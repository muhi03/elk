import{_ as Q}from"./CbHt1iDe.js";import{d as W,c as v,ch as X,A as x,ci as Y,aG as T,bx as J,bV as K,a1 as Z,ah as D,cj as _,aa as ee,F as te,ca as ae,e as g,o as m,g as u,h as a,r as U,Q as S,ac as I,ck as L,f as ne,p as oe,q as N,G as F,t as k,a2 as se}from"./DsX_WIiI.js";var ie=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],C=e=>{let n=0;for(let r=0;r<e.length;r++){let l=e[r],f=ie.indexOf(l);n=n*83+f}return n},O=e=>{let n=e/255;return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)},E=e=>{let n=Math.max(0,Math.min(1,e));return n<=.0031308?Math.trunc(n*12.92*255+.5):Math.trunc((1.055*Math.pow(n,.4166666666666667)-.055)*255+.5)},re=e=>e<0?-1:1,z=(e,n)=>re(e)*Math.pow(Math.abs(e),n),q=class extends Error{constructor(e){super(e),this.name="ValidationError",this.message=e}},le=e=>{if(!e||e.length<6)throw new q("The blurhash string must be at least 6 characters");let n=C(e[0]),r=Math.floor(n/9)+1,l=n%9+1;if(e.length!==4+2*l*r)throw new q(`blurhash length mismatch: length is ${e.length} but it should be ${4+2*l*r}`)},ce=e=>{let n=e>>16,r=e>>8&255,l=e&255;return[O(n),O(r),O(l)]},he=(e,n)=>{let r=Math.floor(e/361),l=Math.floor(e/19)%19,f=e%19;return[z((r-9)/9,2)*n,z((l-9)/9,2)*n,z((f-9)/9,2)*n]},ue=(e,n,r,l)=>{le(e),l=l|1;let f=C(e[0]),y=Math.floor(f/9)+1,P=f%9+1,j=(C(e[1])+1)/166,c=new Array(P*y);for(let s=0;s<c.length;s++)if(s===0){let h=C(e.substring(2,6));c[s]=ce(h)}else{let h=C(e.substring(4+s*2,6+s*2));c[s]=he(h,j*l)}let w=n*4,p=new Uint8ClampedArray(w*r);for(let s=0;s<r;s++)for(let h=0;h<n;h++){let V=0,$=0,M=0;for(let b=0;b<y;b++)for(let t=0;t<P;t++){let o=Math.cos(Math.PI*h*t/n)*Math.cos(Math.PI*s*b/r),d=c[t+b*P];V+=d[0]*o,$+=d[1]*o,M+=d[2]*o}let i=E(V),A=E($),R=E(M);p[4*h+0+s*w]=i,p[4*h+1+s*w]=A,p[4*h+2+s*w]=R,p[4*h+3+s*w]=255}return p},de=ue;const me=["gap"],fe=["poster","muted","controls","width","height"],ve=["src"],ge={key:0,class:"status-attachment-load",absolute:"","text-sm":"","text-white":"",flex:"","flex-col":"","justify-center":"","items-center":"","gap-3":"","w-6":"","h-6":"","pointer-events-none":"","i-ri:video-download-line":""},pe=["poster","muted","width","height"],be=["src"],we={key:0,class:"status-attachment-load",absolute:"","text-sm":"","text-white":"",flex:"","flex-col":"","justify-center":"","items-center":"","gap-3":"","w-6":"","h-6":"","pointer-events-none":"","i-ri:video-download-line":""},ye={key:2,controls:"","h-15":""},Me=["src"],ke=["aria-label"],Pe={key:0,class:"status-attachment-load",absolute:"","text-sm":"","text-white":"",flex:"","flex-col":"","justify-center":"","items-center":"","gap-3":"","w-6":"","h-6":"","pointer-events-none":"","i-ri:file-download-line":""},je={hidden:""},$e={p4:"",flex:"","flex-col":"","gap-2":"","max-w-130":""},Ae={flex:"","justify-between":""},Ue={"font-bold":"","text-xl":"","text-secondary":""},Ce={"text-sm":"","btn-outline":"",py0:"",px2:"","text-secondary":"","border-base":""},Ve={"whitespace-pre-wrap":""},Re={key:1},Se={"aria-hidden":"","font-bold":"","text-sm":"","rounded-1":"","bg-black:65":"","text-white":"","px1.2":"","py0.2":"","pointer-events-none":""},De=W({__name:"StatusAttachment",props:{attachment:{},attachments:{},fullSize:{type:Boolean,default:!1},isPreview:{type:Boolean,default:!1}},setup(e){const n=v(()=>e.attachment.previewUrl||e.attachment.url||e.attachment.remoteUrl),r=v(()=>[[e.attachment.url,e.attachment.meta?.original?.width],[e.attachment.remoteUrl,e.attachment.meta?.original?.width],[e.attachment.previewUrl,e.attachment.meta?.small?.width]].filter(([t])=>t).map(([t,o])=>`${t} ${o}w`).join(", ")),l=v(()=>{if(e.attachment.meta?.original?.aspect)return e.attachment.meta.original.aspect;if(e.attachment.meta?.small?.aspect)return e.attachment.meta.small.aspect}),f=v(()=>{if(e.fullSize)return l.value;if(l.value)return X(l.value,.8,6)}),y=v(()=>{const t=e.attachment.meta?.focus?.x||0,o=e.attachment.meta?.focus?.y||0,d=(t/2+.5)*100,B=(o/-2+.5)*100;return`${d}% ${B}%`}),P={video:["mp4","webm","mov","avi","mkv","flv","wmv","mpg","mpeg"],audio:["mp3","wav","ogg","flac","aac","m4a","wma"],image:["jpg","jpeg","png","svg","webp","bmp"],gifv:["gifv","gif"]},j=v(()=>{if(e.attachment.type&&e.attachment.type!=="unknown")return e.attachment.type;for(const[t,o]of Object.entries(P))if(o.some(d=>n.value?.toLowerCase().endsWith(`.${d}`)))return t;return"unknown"}),c=x(),w=Y(),p=v(()=>e.attachment.type==="audio"),s=v(()=>e.attachment.type==="video"),h=v(()=>e.attachment.type==="gifv"),V=T("enableAutoplay"),$=T("unmuteVideos");J(c,t=>{const o=c.value?.dataset.ready==="true";if(w.value==="reduce"||!V.value){o&&!c.value?.paused&&c.value?.pause();return}t.forEach(d=>{d.intersectionRatio<=.75?o&&!c.value?.paused&&c.value?.pause():c.value?.play().then(()=>{c.value.dataset.ready="true"}).catch(K)})},{threshold:.75});const M=Z(),i=x(e.isPreview||!D(M.value,"enableDataSaving"));function A(){i.value=!0}const R=v(()=>{if(!e.attachment.blurhash)return"";const t=de(e.attachment.blurhash,32,32);return _(t,32,32)}),b=x(i.value?e.attachment.previewUrl:R.value);return ee(i,()=>{b.value=i.value?e.attachment.previewUrl:R.value}),(t,o)=>{const d=Q,B=te("VDropdown"),H=ae("close-popper");return m(),g("div",{relative:"",ma:"",flex:"",gap:a(p)?"2":""},[a(j)==="video"?(m(),g("button",{key:0,type:"button",relative:"",onClick:o[0]||(o[0]=G=>a(i)?null:A())},[u("video",{ref_key:"video",ref:c,preload:"none",poster:a(b),muted:!a($),loop:"",playsinline:"",controls:a(i),"rounded-lg":"","object-cover":"","fullscreen:object-contain":"",width:t.attachment.meta?.original?.width,height:t.attachment.meta?.original?.height,style:I({aspectRatio:a(f),objectPosition:a(y)}),class:S(a(i)?"":"brightness-60 hover:brightness-70 transition-filter")},[u("source",{src:t.attachment.url||t.attachment.previewUrl,type:"video/mp4"},null,8,ve)],14,fe),a(i)?U("",!0):(m(),g("span",ge))])):a(j)==="gifv"?(m(),g("button",{key:1,type:"button",relative:"",onClick:o[1]||(o[1]=G=>a(i)?("openMediaPreview"in t?t.openMediaPreview:a(L))(t.attachments?t.attachments:[t.attachment],t.attachments?.indexOf(t.attachment)||0):A())},[u("video",{ref_key:"video",ref:c,preload:"none",poster:a(b),muted:!a($),loop:"",playsinline:"","rounded-lg":"","object-cover":"",width:t.attachment.meta?.original?.width,height:t.attachment.meta?.original?.height,style:I({aspectRatio:a(f),objectPosition:a(y)})},[u("source",{src:t.attachment.url||t.attachment.previewUrl,type:"video/mp4"},null,8,be)],12,pe),a(i)?U("",!0):(m(),g("span",we))])):a(j)==="audio"?(m(),g("audio",ye,[u("source",{src:t.attachment.url||t.attachment.previewUrl,type:"audio/mp3"},null,8,Me)])):(m(),g("button",{key:3,type:"button","focus:outline-none":"","focus:ring":"2 primary inset","rounded-lg":"","h-full":"","w-full":"","aria-label":t.$t("action.open_image_preview_dialog"),relative:"",onClick:o[2]||(o[2]=G=>a(i)?("openMediaPreview"in t?t.openMediaPreview:a(L))(t.attachments?t.attachments:[t.attachment],t.attachments?.indexOf(t.attachment)||0):A())},[ne(d,{blurhash:t.attachment.blurhash||"",class:S(["status-attachment-image",a(i)?"":"brightness-60 hover:brightness-70 transition-filter"]),src:a(n),srcset:a(r),width:t.attachment.meta?.original?.width,height:t.attachment.meta?.original?.height,alt:t.attachment.description??"Image",style:I({aspectRatio:a(f),objectPosition:a(y)}),"should-load-image":a(i),"rounded-lg":"","h-full":"","w-full":"","object-cover":"",draggable:a(i)},null,8,["blurhash","src","srcset","width","height","alt","style","should-load-image","draggable","class"]),a(i)?U("",!0):(m(),g("span",Pe))],8,ke)),u("div",{class:S(a(p)?[]:["absolute left-2",a(s)?"top-2":"bottom-2"]),flex:"","gap-col-2":""},[t.attachment.description&&!("getPreferences"in t?t.getPreferences:a(D))(a(M),"hideAltIndicatorOnPosts")?(m(),oe(B,{key:0,distance:6,placement:"bottom-start"},{popper:N(()=>[u("div",$e,[u("div",Ae,[u("h2",Ue,k(t.$t("status.img_alt.desc")),1),se((m(),g("button",Ce,[F(k(t.$t("status.img_alt.dismiss")),1)])),[[H]])]),u("p",Ve,k(t.attachment.description),1)])]),default:N(()=>[u("button",{"font-bold":"","text-sm":"",class:S(a(p)?"rounded-full h-15 w-15 btn-outline border-base text-secondary hover:bg-active hover:text-active":"rounded-1 bg-black/65 text-white hover:bg-black px1.2 py0.2")},[u("div",je,k(t.$t("status.img_alt.read",[t.attachment.type])),1),F(" "+k(t.$t("status.img_alt.ALT")),1)],2)]),_:1})):U("",!0),a(h)&&!("getPreferences"in t?t.getPreferences:a(D))(a(M),"hideGifIndicatorOnPosts")?(m(),g("div",Re,[u("button",Se,k(t.$t("status.gif")),1)])):U("",!0)],2)],8,me)}}});export{De as _};
